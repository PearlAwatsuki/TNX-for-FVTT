<form class="{{cssClass}} sheet-profile two-column-layout cast-sheet" autocomplete="off">
    <aside class="profile-sidebar column left-column cast-sidebar">
        <div class="portrait-section">
            <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
        </div>
        <div class="sidebar-personal-data-group">
            <h3 class="sidebar-header">{{localize "TNX.Actor.Profile.Header"}}</h3>
            <div class="personal-data-grid">
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Age"}}</label>
                    <input type="text" name="system.age" value="{{system.age}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Gender"}}</label>
                    <input type="text" name="system.gender" value="{{system.gender}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Birthday"}}</label>
                    <input type="text" name="system.birthday" value="{{system.birthday}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Height"}}</label>
                    <input type="text" name="system.height" value="{{system.height}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Weight"}}</label>
                    <input type="text" name="system.weight" value="{{system.weight}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Eyes"}}</label>
                    <input type="text" name="system.eyes" value="{{system.eyes}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Hair"}}</label>
                    <input type="text" name="system.hair" value="{{system.hair}}"/>
                </div>
                <div class="personal-data-item">
                    <label>{{localize "TNX.Actor.Profile.Skin"}}</label>
                    <input type="text" name="system.skin" value="{{system.skin}}"/>
                </div>
            </div>
        </div>
        <div class="sidebar-hand-pool-section">
            <h3 class="sidebar-header">{{localize "TNX.Actor.Cards.Hand"}}</h3>
            {{#if isEditMode}}
            <div class="sidebar-edit-controls">
                <div class="control-group">
                    <label>{{localize "TNX.Actor.Cards.Hand"}}</label>
                    {{#if system.handPileId}}
                        <button type="button" class="tnx-linked-button" data-action="openHandSheet" data-context-menu-type="unlink" data-unlink-path="system.handPileId">
                            <img src="{{handPile.img}}" class="tnx-linked-button__icon"/><span class="tnx-linked-button__label">{{handPile.name}}</span>
                        </button>
                    {{else}}
                        <div class="tnx-import-box tnx-import-box--panel-dropzone" data-drop-area="hand-pile"><span>{{localize "TNX.Actor.DropHint.Hand"}}</span></div>
                    {{/if}}
                </div>
                <div class="control-group">
                    <label>{{localize "TNX.Actor.Cards.Trump"}}</label>
                    {{#if system.trumpCardPileId}}
                        <button type="button" class="tnx-linked-button" data-action="openTrumpCardSheet" data-context-menu-type="unlink" data-unlink-path="system.trumpCardPileId">
                            <img src="{{trumpCardPile.img}}" class="tnx-linked-button__icon"/><span class="tnx-linked-button__label">{{trumpCardPile.name}}</span>
                        </button>
                    {{else}}
                        <div class="tnx-import-box tnx-import-box--panel-dropzone" data-drop-area="trump-card-pile"><span>{{localize "TNX.Actor.DropHint.Trump"}}</span></div>
                    {{/if}}
                </div>
            </div>
            {{else}}
            <div class="view-mode-hand">
                {{#if handPile}}
                <div class="hand-controls horizontal-buttons">
                    <button type="button" class="tnx-button" data-action="drawCard" {{#if isHandFull}}disabled{{/if}}>
                        <i class="fas fa-hand-paper"></i> {{localize "TNX.Ui.Button.Draw"}}
                    </button>
                    <button type="button" class="tnx-button" data-action="passToOther" {{#unless handPile.cards.length}}disabled{{/unless}}>
                        <i class="fas fa-hand-holding-heart"></i> {{localize "TNX.Ui.Button.Pass"}}
                    </button>
                    <button type="button" class="tnx-button" data-action="useTrumpCard" {{#unless trumpCard}}disabled{{/unless}}>
                        <i class="fas fa-star"></i> {{localize "TNX.Actor.Cards.Trump"}}
                    </button>
                </div>
                <div class="hand-cards-display" data-drop-zone="actor-hand">
                    {{#each handPile.cards as |card|}}
                        <div class="card-in-hand interactive" data-action="playCard" data-card-id="{{card._id}}" title="{{card.name}}">
                            <img src="{{card.faces.[0].img}}" alt="{{card.name}}" />
                        </div>
                    {{/each}}
                    {{#if (eq handPile.cards.length 0)}}<div class="hand-empty-placeholder"><span>{{localize "TNX.Ui.Info.HandEmpty"}}</span></div>{{/if}}
                </div>
                {{else}}
                    <div class="no-item-linked-message"><span>{{localize "TNX.NoHandPoolLinked"}}</span></div>
                {{/if}}
            </div>
            {{/if}}
        </div>
    </aside>

    <section class="main-content-area column right-column">
        <header class="sheet-header profile-header">
            <div class="header-content-wrapper">
                <div class="identity-section">
                    <div class="identity-view-mode">
                        {{#if system.handle}}
                            <span class="handle-quoted-block">
                                <span class="quote-mark">"</span>
                                <ruby class="handle-ruby-view">
                                    <rb>{{system.handle}}</rb>
                                    <rt>{{system.handle_ruby}}</rt>
                                </ruby>
                                <span class="quote-mark">"</span>
                            </span>
                        {{/if}}
                        {{#if actor.name}}
                            <ruby class="char-name-ruby-view">
                                <rb>{{actor.name}}</rb>
                                <rt>{{system.charaname_ruby}}</rt>
                            </ruby>
                        {{else}}
                            {{#unless system.handle}}
                                <span class="no-name-placeholder">{{localize "TNX.NameNotSet"}}</span>
                            {{/unless}}
                        {{/if}}
                    </div>
                    <div class="identity-edit-mode">
                        <label>{{localize "TNX.Actor.Profile.Name"}}</label>
                        <div class="char-name-block-edit">
                            <input name="name" type="text" value="{{actor.name}}">
                            <input name="system.charaname_ruby" type="text" value="{{system.charaname_ruby}}">
                        </div>
                        <label>{{localize "TNX.Actor.Profile.Handle"}}</label>
                        <div class="handle-block-edit">
                            <input name="system.handle" type="text" value="{{system.handle}}">
                            <input name="system.handle_ruby" type="text" value="{{system.handle_ruby}}">
                        </div>
                    </div>
                </div>
                <div class="middle-header-section">
                    <div class="rank-affiliation-wrapper">
                        <div class="citizen-rank-block">
                            <div class="view-mode-rank">
                                <span class="view-mode-label">{{localize "TNX.Actor.Profile.CitizenRank"}}：</span>
                                <span class="view-mode-value">{{system.citizenRank}}</span>
                            </div>
                            <div class="edit-mode-rank">
                                <label>{{localize "TNX.Actor.Profile.CitizenRank"}}：</label>
                                <select name="system.citizenRank">
                                    {{#each citizenRankOptionsForSelect as |o|}}
                                        <option value="{{o.value}}" {{#if o.selected}}selected{{/if}}>{{o.label}}</option>
                                    {{/each}}
                                </select>
                            </div>
                        </div>
                        <div class="affiliation-block">
                            <div class="view-mode-affiliation">
                                <span class="view-mode-label">{{localize "TNX.Actor.Profile.Affiliation"}}：</span>
                                <span class="view-mode-value">{{affiliationDisplay}}</span>
                            </div>
                            <div class="edit-mode-affiliation">
                                <label>{{localize "TNX.Actor.Profile.Affiliation"}}：</label>
                                {{#if equippedAffiliations.length}}
                                    {{#each equippedAffiliations as |item|}}
                                        <button type="button" class="item-button tnx-linked-button" data-action="openItemSheet" data-item-id="{{item._id}}" data-context-menu="item-edit">
                                            <img src="{{item.img}}" class="tnx-linked-button__icon"/>
                                            <span class="tnx-linked-button__label">{{item.name}}</span>
                                        </button>
                                    {{/each}}
                                {{else}}
                                    <div class="tnx-import-box tnx-import-box--inline" data-drop-area="affiliation"><span>{{localize "TNX.Actor.DropHint.Organization"}}</span></div>
                                {{/if}}
                            </div>
                        </div>
                    </div>
                    <div class="view-mode-style-summary">
                        <span class="view-mode-label">{{localize "TNX.Actor.Items.Styles"}}：</span>
                        <span class="style-summary-items">
                            {{#each processedStylesForView as |s|}}
                                <a class="style-summary-item" data-item-id="{{s._id}}">{{s.repeatedName}}{{s.roleIndicatorDisplay}}</a>
                                {{#unless @last}}、{{/unless}}
                            {{/each}}
                        </span>
                    </div>
                    <div class="exp-display-section">
                        <div class="view-mode-exp">
                            <span>{{localize "TNX.Actor.Stats.ExpSpent"}}：</span>
                            <span class="exp-value">{{system.exp.spent}}</span>
                        </div>
                        <div class="edit-mode-exp">
                            <div>
                                <label>{{localize "TNX.Actor.Stats.ExpSpent"}}：</label>
                                <input type="number" name="system.exp.spent" value="{{system.exp.spent}}" class="exp-input" disabled>
                            </div>
                            <div>
                                <label>{{localize "TNX.Actor.Stats.ExpTotal"}}：</label>
                                <input type="number" name="system.exp.total" value="{{system.exp.total}}" class="exp-input">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="styles-and-miracle-section">
                    {{#if isEditMode}}
                    <div class="edit-mode-styles-miracle-block">
                        <div class="item-slots-row">
                            {{#each styleSlots as |slot|}}
                                <div class="style-slot" data-item-id="{{slot._id}}">
                                {{#if slot.isEmpty}}
                                    <div class="tnx-import-box tnx-import-box--inline" data-drop-area="style"><span>{{localize "TNX.Actor.DropHint.Style"}}</span></div>
                                {{else}}
                                    <button type="button" class="item-button tnx-linked-button style-info-button" data-action="openItemSheet" data-item-id="{{slot._id}}" data-context-menu="item-edit">
                                        <img src="{{slot.img}}" class="tnx-linked-button__icon"/>
                                        <span class="tnx-linked-button__label">{{slot.name}}</span>
                                        <div class="style-role-toggle" data-action="toggleStyleRole"><span class="role-indicator {{slot.roleIndicatorClass}}">{{slot.roleIndicatorDisplay}}</span></div>
                                    </button>
                                {{/if}}
                                </div>
                            {{/each}}
                        </div>
                        <div class="item-slots-row">
                            {{#each miracleSlots as |slot|}}
                                <div class="miracle-slot" data-item-id="{{slot._id}}">
                                {{#if slot.isEmpty}}
                                    <div class="tnx-import-box tnx-import-box--inline" data-drop-area="miracle"><span>{{localize "TNX.Actor.DropHint.Miracle"}}</span></div>
                                {{else}}
                                    <button type="button" class="item-button tnx-linked-button" data-action="openItemSheet" data-item-id="{{slot._id}}" data-context-menu="item-edit">
                                        <img src="{{slot.img}}" class="tnx-linked-button__icon"/>{{slot.name}}
                                    </button>
                                {{/if}}
                                </div>
                            {{/each}}
                        </div>
                    </div>
                    {{else}}
                    <div class="view-mode-miracle-actions">
                        <h3 class="miracle-header">{{localize "TNX.Actor.Items.Miracles"}}</h3>
                        <div class="miracle-buttons-grid">
                            {{#each miracleSlotsForView as |dw|}}
                                <button type="button" class="tnx-linked-button miracle-use-button" data-action="useMiracle" data-item-id="{{dw._id}}" {{#if dw.isPlaceholder}}disabled{{/if}} {{#if dw.isDisabled}}disabled{{/if}} data-context-menu="miracle-view">
                                    <i class="fas fa-bolt"></i>
                                    <span class="tnx-linked-button__label miracle-name__label">{{dw.name}}</span>
                                </button>
                            {{/each}}
                        </div>
                    </div>
                    {{/if}}
                </div>
            </div>
            <div class="sheet-controls">
                <button type="button" class="edit-mode-toggle tnx-button tnx-button--toggle" data-action="toggleEditMode" title="表示モード切替">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
        </header>
     
        <section class="tabbed-content">
            <nav class="sheet-tabs tabs tnx-tabs" data-group="primary">
                <a class="item" data-tab="abilities">{{localize "TNX.Ui.Tab.Abilities"}}</a>
                <a class="item" data-tab="outfits">{{localize "TNX.Ui.Tab.Outfits"}}</a>
                <a class="item" data-tab="check">{{localize "TNX.Ui.Tab.Check"}}</a>
                <a class="item" data-tab="status">{{localize "TNX.Ui.Tab.Status"}}</a>
                <a class="item" data-tab="history">{{localize "TNX.Ui.Tab.History"}}</a>
                <a class="item" data-tab="profile">{{localize "TNX.Ui.Tab.Profile"}}</a>
            </nav>
            <section class="sheet-body tnx-body">
                <div class="tab abilities" data-tab="abilities">
                    {{#if isEditMode}}
                        <h2 class="abilities-grid-header">{{localize "TNX.Ui.Header.AbilityControl"}}</h2>
                        <div class="abilities-grid edit-mode-layout">
                            {{#each system.abilities as |ability key|}}
                                <div class="ability-block">
                                    <h3>{{localize ability.label}}</h3>
                                    <div class="value-control-wrapper">
                                        <input type="number" value="{{ability.totalValue}}" class="ability-value" disabled title="{{localize "TNX.Ability.Value"}}">
                                        <span class="separator">/</span>
                                        <input type="number" value="{{ability.totalControl}}" class="control-value" disabled title="{{localize "TNX.Ability.Control"}}">
                                    </div>
                                    <div class="ability-details-toggle" data-action="toggleAbilityDetails">
                                        <span>内訳</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="ability-details-panel" style="display: none;">
                                        <div class="ability-breakdown breakdown-row">
                                            {{#each ability.styleContributions as |style|}}
                                                {{#if style.name}}
                                                    <label class="breakdown-label breakdown-label--style">{{style.name}} (SL{{style.level}})</label>
                                                    <div class="breakdown-item">
                                                        <input class="" type="number" value="{{style.value}}" disabled>
                                                        <span class="separator">/</span>
                                                        <input type="number" value="{{style.control}}" disabled>
                                                    </div>
                                                {{/if}}
                                            {{/each}}
                                            <label class="breakdown-label">効果</label>
                                            <div class="breakdown-item">
                                                <input type="number" name="system.{{key}}.effectMod" value="{{ability.effectMod}}" disabled>
                                                <span class="separator">/</span>
                                                <input type="number" name="system.{{key}}.controlEffectMod" value="{{ability.controlEffectMod}}" disabled>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ability-main-inputs">
                                        <label>成長</label>
                                        <div class="input-row">
                                            <input type="number" name="system.{{key}}.growth" value="{{ability.growth}}">
                                            <span class="separator">/</span>
                                            <input type="number" name="system.{{key}}.controlGrowth" value="{{ability.controlGrowth}}">
                                        </div>
                                        <label>修正</label>
                                        <div class="input-row">
                                            <input type="number" name="system.{{key}}.mod" value="{{ability.mod}}">
                                            <span class="separator">/</span>
                                            <input type="number" name="system.{{key}}.controlMod" value="{{ability.controlMod}}">
                                        </div>
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                    {{else}}
                        <h2 class="abilities-grid-header">{{localize "TNX.Ui.Header.Ability"}}</h2>
                        <div class="abilities-grid view-mode-layout">
                            {{#each system.abilities as |ability key|}}
                                <div class="ability-display">
                                    <div class="ability-label-shape"><div class="ability-label-content"><h3>{{localize ability.label}}</h3></div></div>
                                    <div class="ability-values-area">
                                        <div class="ability-value-shape">
                                            <div class="ability-value-content">
                                                <input type="number" value="{{ability.totalValue}}" readonly>
                                            </div>
                                        </div>
                                        <div class="control-value-shape">
                                            <div class="control-value-content">
                                                <input type="number" value="{{ability.totalControl}}" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                    {{/if}}
                    <div class="skills-section">
                        {{#if isEditMode}}
                            <h2 class="abilities-grid-header">{{localize "TNX.Actor.Items.Skills"}}</h2>
                            {{!-- 編集モード：一般技能セクション --}}
                            <div class="skills-list-edit">
                                <div class="tnx-item-list__row tnx-item-list__row--header skill-group-header">
                                    <h4 class="skill-name-header">{{localize "TNX.Actor.Items.GeneralSkills"}}</h4>
                                    {{!-- 【変更点2】一般技能追加ボタン --}}
                                    <a class="item-control item-create" data-type="skill" data-category="generalSkill" title="{{localize 'TNX.Common.Add'}}">
                                        <i class="fas fa-plus"></i> {{localize "TNX.Common.Add"}}
                                    </a>
                                </div>
                                
                                <div class="skill-group-block">
                                    <ol class="item-list">
                                        {{!-- 【変更点1】generalSkillsをループ --}}
                                        {{#each generalSkills as |item|}}
                                            <li class="item" data-item-id="{{item._id}}">
                                                <div class="item-name">
                                                    <a class="item-name">{{#if item.system.isAction}}★{{else}}　{{/if}}{{item.name}}</a>
                                                </div>
        
                                                <div class="skill-level-container">
                                                    <input type="number" class="skill-property-change" data-target="level" value="{{item.system.level}}" placeholder="Lv" />
                                                    
                                                    <div class="skill-suits-row">
                                                        {{#each ../TNX.SUITS as |suitData key|}}
                                                            <label class="suit-checkbox-tiny" title="{{localize suitData.label}}">
                                                                {{!-- generalSkill.initialSkill.initialSuit 等の制約処理は必要に応じて残す --}}
                                                                <input type="checkbox" class="skill-property-change" data-target="suit" data-suit="{{key}}" {{checked (lookup item.system.suits key)}} />
                                                                <i class="{{suitData.icon}}"></i>
                                                            </label>
                                                        {{/each}}
                                                    </div>
                                                </div>
                                                <div class="item-controls">
                                                    <a class="item-control item-edit" title="{{localize 'SHEET.ItemEdit'}}" data-item-id="{{item._id}}"><i class="fas fa-edit"></i></a>
                                                    <a class="item-control item-delete" title="{{localize 'SHEET.ItemDelete'}}" {{#if (eq item.system.generalSkill.generalSkillCategory "initialSkill")}}disabled{{/if}} {{#if item.system.generalSkill.onomasticSkill.isInitial}}disabled{{/if}}><i class="fas fa-trash"></i></a>
                                                </div>
                                            </li>
                                        {{/each}}
                                    </ol>
                                </div>

                                {{!-- 編集モード：スタイル技能セクション --}}
                                <div class="tnx-item-list__row tnx-item-list__row--header skill-group-header">
                                    <h4 class="skill-name-header">{{localize "TNX.Actor.Items.StyleSkills"}}</h4>
                                    {{!-- 【変更点2】スタイル技能追加ボタン --}}
                                    <a class="item-control item-create" data-type="skill" data-category="styleSkill" title="{{localize 'TNX.Common.Add'}}">
                                        <i class="fas fa-plus"></i> {{localize "TNX.Common.Add"}}
                                    </a>
                                </div>

                                <div class="skill-group-block">
                                    <ol class="item-list">
                                        {{!-- 【変更点1】styleSkillsをループ --}}
                                        {{#each styleSkills as |item|}}
                                            <li class="item" data-item-id="{{item._id}}">
                                                <div class="item-name">
                                                    <a class="item-name">{{item.name}}</a>
                                                </div>
                                                
                                                <div class="skill-level-container">
                                                    <input type="number" class="skill-property-change" data-target="level" value="{{item.system.level}}" placeholder="Lv" />
                                                    
                                                    <div class="skill-suits-row">
                                                        {{#each ../TNX.SUITS as |suitData key|}}
                                                            <label class="suit-checkbox-tiny" title="{{localize suitData.label}}">
                                                                <input type="checkbox" class="skill-property-change" data-target="suit" data-suit="{{key}}" {{checked (lookup item.system.suits key)}} />
                                                                <i class="{{suitData.icon}}"></i>
                                                            </label>
                                                        {{/each}}
                                                    </div>
                                                </div>

                                                <div class="item-controls">
                                                    <a class="item-control item-edit" title="{{localize 'SHEET.ItemEdit'}}" data-item-id="{{item._id}}"><i class="fas fa-edit"></i></a>
                                                    <a class="item-control item-delete" title="{{localize 'SHEET.ItemDelete'}}"><i class="fas fa-trash"></i></a>
                                                </div>
                                            </li>
                                        {{/each}}
                                    </ol>
                                </div>
                            </div>
                        {{else}}
                            {{!-- 閲覧モード --}}
                            <div class="skills-section">
                                <h2 class="abilities-grid-header">{{localize "TNX.Actor.Items.GeneralSkills"}}</h2>
                                <div class="skills-list-view">
                                    {{#each generalSkillColumns as |columnItems|}}
                                        <div class="skills-column">
                                            {{#each columnItems as |item|}}
                                                <div class="general-skill-display">
                                                    <div class="skill-label-shape">
                                                        <a class="skill-label-content squeeze-text">
                                                            {{#if item.system.isAction}}★{{/if}}{{item.name}}
                                                        </a>
                                                    </div>
                                                    <div class="skill-meta-data">
                                                        <span class="skill-level">Lv{{item.system.level}}</span>
                                                        <div class="skill-suits-view">
                                                            <i class="fas fa-spade suit-icon {{#if item.system.suits.spade}}active{{else}}inactive{{/if}}"></i>
                                                            <i class="fas fa-club suit-icon {{#if item.system.suits.club}}active{{else}}inactive{{/if}}"></i>
                                                            <i class="fas fa-heart suit-icon {{#if item.system.suits.heart}}active{{else}}inactive{{/if}}"></i>
                                                            <i class="fas fa-diamond suit-icon {{#if item.system.suits.diamond}}active{{else}}inactive{{/if}}"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            {{/each}}
                                        </div>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="skills-section">
                                <h2 class="abilities-grid-header">{{localize "TNX.Actor.Items.StyleSkills"}}</h2>
                                <div class="style-skills-list-wrapper">
                                    {{!-- ヘッダー行 --}}
                                    <div class="style-skill-header style-skill-grid">
                                        <div class="cell cell-name">{{localize "TNX.Common.Name"}}</div>
                                        <div class="cell cell-level">Lv</div>
                                        <div class="cell cell-combo">{{localize "TNX.Item.Skill.Combo"}}</div>
                                        <div class="cell cell-max">{{localize "TNX.Item.Skill.MaxLevel"}}</div>
                                        <div class="cell cell-timing">{{localize "TNX.Item.Skill.Timing"}}</div>
                                        <div class="cell cell-target">{{localize "TNX.Item.Skill.Target"}}</div>
                                        <div class="cell cell-range">{{localize "TNX.Item.Skill.Range"}}</div>
                                        <div class="cell cell-tn">{{localize "TNX.Item.Skill.TargetValue"}}</div>
                                        <div class="cell cell-confront">{{localize "TNX.Item.Skill.Confrontation"}}</div>
                                        <div class="cell cell-other"></div>
                                    </div>

                                    {{!-- リスト本体 --}}
                                    <ol class="style-skills-list">
                                        {{#each styleSkills as |item|}}
                                            <li class="item style-skill-row style-skill-grid" data-item-id="{{item._id}}">
                                                {{!-- 名称 --}}
                                                <div class="cell cell-name">
                                                    <a class="item-name">{{item.name}}</a>
                                                </div>

                                                {{!-- レベル＆スート（横並びコンテナ） --}}
                                                <div class="cell cell-level">
                                                    <div class="level-container">
                                                        <span class="level-number">{{item.system.level}}</span>
                                                        <div class="level-suits">
                                                            <i class="fas fa-spade suit-icon {{#if item.system.suits.spade}}active{{else}}inactive{{/if}}"></i>
                                                            <i class="fas fa-club suit-icon {{#if item.system.suits.club}}active{{else}}inactive{{/if}}"></i>
                                                            <i class="fas fa-heart suit-icon {{#if item.system.suits.heart}}active{{else}}inactive{{/if}}"></i>
                                                            <i class="fas fa-diamond suit-icon {{#if item.system.suits.diamond}}active{{else}}inactive{{/if}}"></i>
                                                        </div>
                                                    </div>
                                                </div>

                                                {{!-- その他パラメータ --}}
                                                <div class="cell cell-combo">
                                                    <span class="squeeze-text">{{item.view.comboSkill}}</span>
                                                </div>
                                                <div class="cell cell-max">
                                                    <span class="squeeze-text">{{item.view.maxLevel}}</span>
                                                </div>
                                                <div class="cell cell-timing">
                                                    <span class="squeeze-text">{{item.view.timing}}</span>
                                                </div>
                                                <div class="cell cell-target">
                                                    <span class="squeeze-text">{{item.view.target}}</span>
                                                </div>
                                                <div class="cell cell-range">
                                                    <span class="squeeze-text">{{item.view.range}}</span>
                                                </div>
                                                <div class="cell cell-tn">
                                                    <span class="squeeze-text">{{item.view.targetValue}}</span>
                                                </div>
                                                <div class="cell cell-confront">
                                                    <span class="squeeze-text">{{item.view.confrontation}}</span>
                                                </div>
                                                <div class="cell cell-other">
                                                    <a class="item-menu-trigger" data-item-id="{{item._id}}" title="{{localize 'TNX.Common.Menu'}}">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </a>
                                                </div>
                                            </li>
                                        {{/each}}
                                    </ol>
                                </div>
                            </div>
                        {{/if}}
                    </div>
                </div>

                <div class="tab outfits" data-tab="outfits"></div>

                <div class="tab check" data-tab="check"></div>

                <div class="tab status" data-tab="status"></div>

                <div class="tab history" data-tab="history">
                    {{!-- レコードシート連携エリア --}}
                    {{#if isEditMode}}
                        <div class="record-link-section">
                            <label>レコードシート連携：</label>
                            
                            {{!-- サイズを固定・統一するためのラッパー --}}
                            <div class="record-slot">
                                {{#if recordSheet}}
                                    {{!-- リンク済みの場合のボタン --}}
                                    <div class="record-link-container">
                                        <button type="button" class="tnx-linked-button record-sheet-open" title="クリックで開く / 右クリックで解除">
                                            <img src="{{recordSheet.img}}" class="tnx-linked-button__icon"/>
                                            <span class="tnx-linked-button__label">{{recordSheet.name}}</span>
                                        </button>
                                    </div>
                                {{else}}
                                    {{!-- 未リンクの場合のドロップエリア --}}
                                    <div class="tnx-import-box tnx-import-box--inline" data-drop-area="record-sheet">
                                        <span>レコードシートをドロップ</span>
                                    </div>
                                {{/if}}
                            </div>
                        </div>
                        <hr>
                    {{/if}}

                    {{> "systems/tokyo-nova-axleration/templates/parts/history-list.hbs"}}
                </div>

                <div class="tab profile" data-tab="profile"></div>

            </section>
        </section>
    </section>
</form>