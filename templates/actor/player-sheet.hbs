<form class="{{cssClass}} sheet-profile two-column-layout cast-sheet player-sheet" autocomplete="off">
    
    {{!-- 左カラム：サイドバー --}}
    <aside class="profile-sidebar column left-column cast-sidebar">
        <div class="portrait-section">
            <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
        </div>

        {{!-- キャストシートの「手札」セクションのクラスを流用 --}}
        <div class="sidebar-hand-pool-section">
            <h3 class="sidebar-header">{{localize "TNX.Actor.Cards.Hand"}} & {{localize "TNX.Actor.Cards.Trump"}}</h3>
            
            {{#if isEditMode}}
                {{!-- 編集モード：リンク設定 --}}
                <div class="sidebar-edit-controls">
                    
                    {{!-- 手札設定 --}}
                    <div class="control-group">
                        <label>{{localize "TNX.Actor.Cards.Hand"}}</label>
                        {{#if system.handPileId}}
                            <button type="button" class="tnx-linked-button open-hand" data-context-menu-type="unlink" data-unlink-path="system.handPileId">
                                <img src="{{handPile.img}}" class="tnx-linked-button__icon"/>
                                <span class="tnx-linked-button__label">{{handPile.name}}</span>
                            </button>
                        {{else}}
                            <div class="tnx-import-box tnx-import-box--panel-dropzone" data-drop-area="hand-pile">
                                <span>{{localize "TNX.Actor.DropHint.Hand"}}</span>
                            </div>
                        {{/if}}
                    </div>

                    {{!-- 切り札設定 --}}
                    <div class="control-group">
                        <label>{{localize "TNX.Actor.Cards.Trump"}}</label>
                        {{#if system.trumpCardPileId}}
                            <button type="button" class="tnx-linked-button open-trump" data-context-menu-type="unlink" data-unlink-path="system.trumpCardPileId">
                                <img src="{{trumpPile.img}}" class="tnx-linked-button__icon"/>
                                <span class="tnx-linked-button__label">{{trumpPile.name}}</span>
                            </button>
                        {{else}}
                            <div class="tnx-import-box tnx-import-box--panel-dropzone" data-drop-area="trump-card-pile">
                                <span>{{localize "TNX.Actor.DropHint.Trump"}}</span>
                            </div>
                        {{/if}}
                    </div>

                    {{!-- 自動作成ボタン（どちらかが欠けている時のみ表示） --}}
                    {{#unless (and system.handPileId system.trumpCardPileId)}}
                        <div class="control-group">
                            <button type="button" class="tnx-button create-piles">
                                <i class="fas fa-plus-circle"></i> 作成
                            </button>
                        </div>
                    {{/unless}}
                </div>

            {{else}}
                {{!-- 閲覧モード：カード操作 --}}
                <div class="view-mode-hand">
                    <div class="hand-controls horizontal-buttons">
                        {{#if system.handPileId}}
                            <button type="button" class="tnx-button open-hand">
                                <i class="fas fa-hand-paper"></i> {{localize "TNX.Actor.Cards.Hand"}}
                            </button>
                        {{else}}
                            <div class="no-item-linked-message"><span>{{localize "TNX.NoHandPoolLinked"}}</span></div>
                        {{/if}}
                        
                        {{#if system.trumpCardPileId}}
                            <button type="button" class="tnx-button open-trump">
                                <i class="fas fa-star"></i> {{localize "TNX.Actor.Cards.Trump"}}
                            </button>
                        {{/if}}
                    </div>
                </div>
            {{/if}}
        </div>
    </aside>

    {{!-- 右カラム：メインコンテンツ --}}
    <section class="main-content-area column right-column">
        
        <header class="sheet-header profile-header">
            <div class="header-content-wrapper">
                
                {{!-- 名前エリア --}}
                <div class="identity-section">
                    {{#if isEditMode}}
                        <div class="identity-edit-mode">
                            <label>{{localize "TNX.Actor.Profile.Name"}}</label>
                            <div class="char-name-block-edit">
                                <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'TNX.Common.Name'}}"/>
                            </div>
                        </div>
                    {{else}}
                        <div class="identity-view-mode">
                            {{#if actor.name}}
                                <span class="char-name-ruby-view" style="font-size: 2em; font-weight: bold;">{{actor.name}}</span>
                            {{else}}
                                <span class="no-name-placeholder">{{localize "TNX.NameNotSet"}}</span>
                            {{/if}}
                        </div>
                    {{/if}}
                </div>

                {{!-- 経験点表示エリア（キャストシートのレイアウトを流用） --}}
                <div class="middle-header-section">
                    <div class="exp-display-section" style="width: 100%;">
                        {{#if isEditMode}}
                            <div class="edit-mode-exp">
                                <div>
                                    <label>{{localize "TNX.Actor.Stats.Exp"}}：</label>
                                    <span>{{system.exp.value}}</span>
                                </div>
                                <div>
                                    <label>{{localize "TNX.Actor.Stats.ExpSpent"}}：</label>
                                    <span>{{system.exp.spent}}</span>
                                </div>
                                <div>
                                    <label>{{localize "TNX.Actor.Stats.ExpTotal"}}：</label>
                                    <span>{{system.exp.total}}</span>
                                </div>
                            </div>
                        {{else}}
                            <div class="view-mode-exp">
                                <span class="view-mode-label" style="font-size: 1.2em;">{{localize "TNX.Actor.Stats.Exp"}}：</span>
                                <span class="exp-value" style="font-size: 1.5em; margin-right: 15px;">{{system.exp.value}}</span>
                                
                                <span class="view-mode-label">{{localize "TNX.Actor.Stats.ExpSpent"}}：</span>
                                <span class="exp-value">{{system.exp.spent}}</span>
                                <span style="margin: 0 5px;">/</span>
                                <span class="view-mode-label">{{localize "TNX.Actor.Stats.ExpTotal"}}：</span>
                                <span class="exp-value">{{system.exp.total}}</span>
                            </div>
                        {{/if}}
                    </div>
                </div>
            </div>
            
            <div class="sheet-controls">
                <button type="button" class="edit-mode-toggle tnx-button tnx-button--toggle" data-action="toggleEditMode" title="編集モード切替">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
        </header>

        <section class="tabbed-content">
            <nav class="sheet-tabs tabs tnx-tabs" data-group="primary">
                <a class="item" data-tab="history">{{localize "TNX.Ui.Tab.History"}}</a>
            </nav>

            <section class="sheet-body tnx-body">
                <div class="tab history" data-tab="history">
                    {{!-- 履歴リスト（共通パーツ） --}}
                    {{> "systems/tokyo-nova-axleration/templates/parts/history-list.hbs"}}
                </div>
            </section>
        </section>
    </section>
</form>