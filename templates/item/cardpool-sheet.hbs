<form class="{{options.classes}} cardpool-sheet" autocomplete="off">
    <header class="sheet-header">
        <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="{{item.name}}"/></h1>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="operations">{{localize "TNX.CardOperations"}}</a>
        <a class="item" data-tab="settings">{{localize "TNX.Setting"}}</a>
    </nav>

    <section class="sheet-body">
        <div class="tab operations" data-group="primary" data-tab="operations">
            {{#unless system.linkedHandPileId}}
                <p class="notes">{{localize "TNX.LinkCardsInSettingsHint"}}</p>
            {{else}}
                {{!-- Deck & Neuro Deck Mode --}}
                {{#if (or (eq system.mode "deck") (eq system.mode "neuro"))}}
                    <div class="deck-operations-grid">
                        <div class="deck-display">
                            <div class="deck-info">
                                <span>{{localize "TNX.RemainingCards"}}:</span>
                                <span class="card-count">{{operationData.cardCount}}</span>
                            </div>
                            {{#if (gt operationData.cardCount 0)}}
                                <button type="button" class="tnx-card-display" data-action="draw-card" title="{{localize 'TNX.DrawCardHint'}}">
                                    <img src="{{operationData.backImage}}" alt="{{localize 'TNX.DeckBack'}}">
                                </button>
                            {{else}}
                                <div class="tnx-import-box tnx-import-box--deck">
                                    <p>{{localize "TNX.DeckEmpty"}}</p>
                                </div>
                            {{/if}}
                        </div>
                        <div class="deck-actions-panel">
                             {{#if (eq system.mode "deck")}}
                                <button type="button" class="tnx-button" data-action="shuffle" {{#unless isGM}}disabled{{/unless}}>
                                    <i class="fas fa-random"></i> {{localize "TNX.Shuffle"}}
                                </button>
                                <button type="button" class="tnx-button" data-action="deal-to-all" {{#unless isGM}}disabled{{/unless}}>
                                    <i class="fas fa-users"></i> {{localize "TNX.DealInitialHand"}}
                                </button>
                                <button type="button" class="tnx-button" data-action="draw-specific-amount">
                                    <i class="fas fa-hand-paper"></i> {{localize "TNX.DrawSpecificAmount"}}
                                </button>
                                <button type="button" class="tnx-button" data-action="collect-all-cards" {{#unless isGM}}disabled{{/unless}}>
                                    <i class="fas fa-recycle"></i> {{localize "TNX.CollectAllCards"}}
                                </button>
                            {{/if}}
                            {{#if (eq system.mode "neuro")}}
                                 <button type="button" class="tnx-button" data-action="shuffle" {{#unless isGM}}disabled{{/unless}}>
                                    <i class="fas fa-random"></i> {{localize "TNX.Shuffle"}}
                                </button>
                                <button type="button" class="tnx-button" data-action="deal-trump-card" {{#unless isGM}}disabled{{/unless}}>
                                    <i class="fas fa-star"></i> {{localize "TNX.DealTrumpCard"}}
                                </button>
                                <button type="button" class="tnx-button" data-action="collect-all-cards" {{#unless isGM}}disabled{{/unless}}>
                                    <i class="fas fa-recycle"></i> {{localize "TNX.CollectAllCards"}}
                                </button>
                            {{/if}}
                        </div>
                    </div>
                {{/if}}

                {{!-- Discard Pile Mode --}}
                {{#if (eq system.mode "discard")}}
                    <div class="discard-operations-grid">
                        <div class="discard-display">
                            <div class="discard-info">
                                <span>{{localize "TNX.CardsInDiscard"}}:</span>
                                <span class="card-count">{{operationData.cardCount}}</span>
                            </div>
                            {{#if operationData.topCardImage}}
                                <button type="button" class="tnx-card-display" data-action="take-from-discard" title="{{localize 'TNX.TakeFromDiscardHint'}}">
                                    <img src="{{operationData.topCardImage}}" alt="{{operationData.topCardName}}">
                                </button>
                            {{else}}
                                <div class="tnx-import-box tnx-import-box--deck">
                                    <p>{{localize "TNX.DiscardPileEmpty"}}</p>
                                </div>
                            {{/if}}
                        </div>
                    </div>
                {{/if}}

                {{!-- Scene Card Mode --}}
                {{#if (eq system.mode "scene")}}
                    <div class="scene-operations-grid">
                        {{#if operationData.cardImage}}
                            <div class="scene-card-header">
                                <h2>{{{operationData.cardName}}}</h2>
                            </div>
                            <div class="scene-card-content">
                                <div class="scene-card-image-wrapper">
                                    <div class="tnx-card-display">
                                        <img src="{{operationData.cardImage}}" class="scene-card-image" alt="{{operationData.cardName}}">
                                    </div>
                                </div>
                                <div class="scene-card-details">
                                    <div class="detail-block">
                                        <h3>キーワード</h3>
                                        <p>{{operationData.keyword}}</p>
                                    </div>
                                    <div class="detail-block">
                                        <h3>暗示</h3>
                                        <p>{{operationData.implication}}</p>
                                    </div>
                                </div>
                            </div>
                        {{else}}
                            <div class="tnx-import-box tnx-import-box--deck">
                                <p>{{localize "TNX.SceneCardPileEmpty"}}</p>
                            </div>
                        {{/if}}
                    </div>
                {{/if}}
            {{/unless}}
        </div>
      
        <div class="tab settings" data-group="primary" data-tab="settings">
            <div class="form-group">
                <label>{{localize "TNX.CardPoolMode"}}</label>
                <select name="system.mode" class="tnx-form-field" {{#unless isGM}}disabled{{/unless}}>
                    {{#each cardPoolModeOptions as |option|}}            
                        <option value="{{option.value}}" {{#if option.selected}}selected{{/if}}>{{option.label}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="form-group drop-zone-area linked-cards-display-area">
                <label>{{localize "TNX.CardPoolLinkedHandPileId"}}</label>
                {{#if system.linkedHandPileId}}
                    <button type="button" class="tnx-linked-button" data-action="open-linked-sheet" title="{{localize 'クリックでシートを開く'}}" {{#unless isGM}}disabled{{/unless}}>
                        <i class="fas fa-clone tnx-linked-button__icon"></i>
                        <span class="tnx-linked-button__label">{{linkedCards.name}}</span>             
                    </button>
                {{else}}
                    <div class="tnx-import-box tnx-import-box--dropzone">
                        <span>{{localize 'TNX.CardPoolLinkedHandPileIdHint'}}</span>
                    </div>
                {{/if}}
            </div>
    
            <div class="form-group">
                <button type="button" class="tnx-button" data-action="create-and-link-document" {{#unless isGM}}disabled{{/unless}}>
                    <i class="fas fa-plus-square"></i> {{localize createActionData.label}}
                </button>
                <p class="notes">{{localize createActionData.hint}}</p>
            </div>
        </div>
    </section>
</form>